# Candidate Adapter Contract
# Bridge between protease_promote.py output and lattice_annealer.py input
# Source: Adjudicator Bid CC35, Spec Amendment #3
version: "1.0.0"

protease_promote_output:
  description: "Current output of protease_promote.py when promoting an atom"
  fields:
    atom_id: string
    source_file: string
    content: string
    origin_hash: string
    axiom_alignment_score: float
    terminal_domain: string
    matched_intention: string
    drift_score: float

annealer_required_input:
  description: "Full input schema required by lattice_annealer.py"
  fields:
    atom_id: string
    source_atom_ids: array[string]
    content: string
    metadata:
      origin_hash: string
      axiom_alignment_score: float
      terminal_domain: string
      matched_intention: string
      drift_score: float
    rosetta_terms: array[string]
    dimension_vector:
      mode_of_access: float
      content_domain: float
      transformative_depth: float
      social_distribution: float
      practical_application: float
    proposed_edges:
      canonical_node_ids: array[string]

adapter_rules:
  - field: source_atom_ids
    source: "Derive from atom_id lineage in protease_queue metadata"
    fallback: "[atom_id]"

  - field: rosetta_terms
    source: "Extract via REF-ROSETTA_STONE.md term matching against content"
    fallback: "[]"
    note: "Empty rosetta_terms will cause low coherence score in annealer â€” acceptable for first pass"

  - field: dimension_vector
    source: "Compute from CANON-00016 dimensional taxonomy against content"
    fallback: "All zeros (0.0)"
    note: "Zero vectors will score poorly but won't crash annealer"

  - field: proposed_edges.canonical_node_ids
    source: "Identify existing canon nodes referenced in content via node_id pattern matching"
    fallback: "[]"
    note: "Empty edges yield backlink_score=0.0, reducing coherence. Iterative adjust loop may fix."

implementation:
  location: "orchestration/00-ORCHESTRATION/scripts/candidate_adapter.py"
  estimated_loc: 120
  dependencies:
    - engine/02-ENGINE/REF-ROSETTA_STONE.md
    - canon/01-CANON/CANON-00016-ONTOLOGICAL_FRAMEWORK-cosmos.md
    - orchestration/00-ORCHESTRATION/state/DYN-LATTICE_INDEX.json
