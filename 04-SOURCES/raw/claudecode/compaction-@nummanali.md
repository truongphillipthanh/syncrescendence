Claude Code v2.1.3 has solved the compaction issue

Auto compaction works very well if you start with Plan Mode and explicitly ask the model to make a Comprehensive To Do list

Plans and To Dos persist across compaction

Runtime was 52m 54s with beautifully written code